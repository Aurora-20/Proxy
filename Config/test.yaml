######### 锚点 start #######
pr:
  &proxy {
    type: select,
    proxies:
      [🇭🇰 Hong Kong, 🇯🇵 Japan, 🇺🇸 United States, 🇹🇼 Taiwan, 🇸🇬 Singapore],
  }
p:
  &p {
    type: http,
    interval: 3600,
    health-check:
      {
        enable: true,
        url: https://www.apple.com/library/test/success.html,
        interval: 300,
      },
  }
auto:
  &auto {
    type: url-test,
    lazy: true,
    url: https://www.apple.com/library/test/success.html,
    interval: 600,
    tolerance: 10,
    use: [Subscribe],
  }
use: &use { type: select, use: [Subscribe] }
c: &classical { type: http, behavior: classical, interval: 86400 }
d: &domain { type: http, behavior: domain, interval: 86400 }
i: &ipcidr { type: http, behavior: ipcidr, interval: 86400 }
######### 锚点 end #######

proxy-providers:
  Subscribe:
    <<: *p
    url: https://mirror.ghproxy.com/https://gist.githubusercontent.com/Aurora-20/fab3130bf6202d6e69b3592b5209efd6/raw/All
    path: ./proxy_providers/tmp.yaml

ipv6: false
allow-lan: false
mixed-port: 7890
unified-delay: false
tcp-concurrent: true
external-controller: 127.0.0.1:9090
external-ui: ui
external-ui-url: "https://github.com/MetaCubeX/metacubexd/releases/download/v1.134.0/compressed-dist.tgz"

geodata-mode: true
geox-url:
  geoip: "https://mirror.ghproxy.com/https://github.com/MetaCubeX/meta-rules-dat/releases/download/latest/geoip-lite.dat"
  geosite: "https://mirror.ghproxy.com/https://github.com/MetaCubeX/meta-rules-dat/releases/download/latest/geosite.dat"

find-process-mode: strict
global-client-fingerprint: chrome

profile:
  store-selected: true
  store-fake-ip: true

sniffer:
  enable: true
  sniff:
    HTTP:
      ports: [80, 8080-8880]
      override-destination: true
    TLS:
      ports: [443, 8443]
    QUIC:
      ports: [443, 8443]
  skip-domain:
    - "Mijia Cloud"

tun:
  enable: true
  stack: mixed
  dns-hijack:
    - "any:53"
  auto-route: true
  auto-detect-interface: true

bind-address: "*" # 地址绑定
mode: rule # 规则模式
log-level: info # 日志级别

dns:
  enable: true
  listen: :1053
  ipv6: true
  enhanced-mode: fake-ip
  fake-ip-filter:
    - "*"
    - "+.lan"
    - "+.local"
  nameserver:
    - https://doh.pub/dns-query
    - https://dns.alidns.com/dns-query
  proxy-server-nameserver:
    - https://doh.pub/dns-query
  nameserver-policy:
    "geosite:private":
      - https://doh.pub/dns-query
      - https://dns.alidns.com/dns-query
    "geosite:geolocation-!cn":
      - "https://dns.cloudflare.com/dns-query#dns"
      - "https://dns.google/dns-query#dns"

proxies: null
proxy-groups:
  [
    { name: 🚀 Default, <<: *proxy },
    { name: ⏬ Downloads, type: select, proxies: [💩 Shit, 🆓 Welfare] },
    { name: 🇭🇰 Hong Kong, <<: *auto, filter: "(?i)港|hk|hongkong|hong kong" },
    { name: 🇯🇵 Japan, <<: *auto, filter: "(?i)日本|jp|japan" },
    { name: 🇹🇼 Taiwan, <<: *auto, filter: "(?i)台|tw|taiwan" },
    {
      name: 🇺🇸 United States,
      <<: *auto,
      filter: "(?i)美|unitedstates|united states",
    },
    { name: 🇸🇬 Singapore, <<: *auto, filter: "(?i)(新|sg|singapore|狮城)" },
    { name: 💩 Shit, <<: *auto, filter: "^PPG|V.*$" },
    { name: 🆓 Welfare, <<: *use, filter: "0.[0-9]+" },
  ]
rule-providers:
  Downloads:
    {
      <<: *classical,
      url: https://raw.tuu.cat/blackmatrix7/ios_rule_script/master/rule/Clash/Download/Download.yaml,
      path: ./ruleset/Downloads.yaml,
    }
  Emby:
    {
      <<: *classical,
      url: https://raw.tuu.cat/Aurora-20/Proxy/main/Rules/Clash/Emby/Emby.yaml,
      path: ./ruleset/Emby.yaml,
    }
rules:
  - GEOSITE,CN,DIRECT
  - GEOIP,lan,DIRECT,no-resolve
  - GEOSITE,telegram,🇸🇬 Singapore
  - RULE-SET,Downloads,⏬ Downloads
  - RULE-SET,Emby,⏬ Downloads
  - MATCH,🚀 Default
